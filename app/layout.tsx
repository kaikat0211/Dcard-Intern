import type { Metadata } from "next";
import Header from './components/Header'
import "./globals.css";
import StoreProvider from "./StoreProvider";
import { getUserGitHubId } from "./useractions";
import getUserData from "@/lib/user/fetchUserData";


export const metadata: Metadata = {
  title: "Dcard Intern",
  description: "Generated by create next app",
};


export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) 
{
  const userInfo = await getUserGitHubId()
  const userID = userInfo.userId
  const photo = userInfo.userPhoto
  const data = await getUserData(userID)
  if (!data) {
    return (
      <html lang="en">
        <body className='bg-bodycolor'>
          <div className="text-white text-2xl">Loading...</div>
        </body>
      </html>
    )
  }
  return (
  <StoreProvider>
    <html lang="en">
        <body className='bg-bodycolor'>
          <Header profileData={data} photo={photo}/>
          {children}
        </body>
    </html>
  </StoreProvider>
  );
}


////切版在下面


// import type { Metadata } from "next";
// import Header from './components/Header'
// import { options, auth } from './api/auth/[...nextauth]/options';
// import "./globals.css";
// import StoreProvider from "./StoreProvider";
// import { usePathname } from "next/navigation";
// // async function getUserData() {
// //   const session = await auth();
// //   const token = session?.token;
// //   const response = await fetch(`https://api.github.com/users/${session?.user?.name}`, {
// //     headers: {
// //       Authorization: `Bearer ${token}`,
// //     },
// //   });
// //   const userInfo = await response.json();
// //   const repoRes = await fetch(userInfo.repos_url);
// //   const repoData = await repoRes.json() ; //origin
// //   const copyRepoData = JSON.parse(JSON.stringify(repoData))
// //   const repoInfoPromises = copyRepoData.map((repo: any) => {
// //     const repoName = repo.name;
// //     const issuesUrl = repo.issues_url.replace(/{\/number}/g, '');
// //     return { [repoName]: { getIssueUrl: issuesUrl }};
// //   });

// //   // 等待所有存储库的信息都被获取
// //   const repoInfos = await Promise.all(repoInfoPromises);

// //   // 将存储库信息整合到一个对象中
// //   const repoInfo: { [key: string]: { getIssueUrl: string } } = {};
// //   repoInfos.forEach((info: any) => {
// //     const repoName = Object.keys(info)[0];
// //     const { getIssueUrl } = info[repoName];
// //     repoInfo[repoName] = { getIssueUrl };
// //   });

// //   return { userInfo, repoInfo };
// // }



// export const metadata: Metadata = {
//   title: "Dcard Intern",
//   description: "Generated by create next app",
// };


// export default async function RootLayout({
//   children,
// }: Readonly<{
//   children: React.ReactNode;
// }>) 
// {
//   // const data = await getUserData()
//   // if (!data) {
//   //   return (
//   //     <html lang="en">
//   //       <body className='bg-bodycolor'>
//   //         <div className="text-white text-2xl">Loading...</div>
//   //       </body>
//   //     </html>
//   //   )
//   // }
//   return (
//   <StoreProvider>
//     <html lang="en">
//         <body className='bg-bodycolor'>
//           {/* <Header profileData={data}/> */}
//           {children}
//         </body>
//     </html>
//   </StoreProvider>
//   );
// }



