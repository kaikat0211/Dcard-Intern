import type { Metadata } from "next";
import Header from './components/Header'
import Nav from './components/Nav'
import { options, auth } from './api/auth/[...nextauth]/options';
import "./globals.css";
import StoreProvider from "./StoreProvider";
async function getUserData() {
  const session = await auth();
  const token = session?.token;
  const response = await fetch(`https://api.github.com/users/${session?.user?.name}`, {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });
  const userInfo = await response.json();
  const repoRes = await fetch(userInfo.repos_url)
  const repoData = await repoRes.json()
  const repoInfo: { [key: string]: { getIssueUrl: string } } = {};
  repoData.forEach((r : { name: string; issues_url: string })  => {
      repoInfo[r.name] = {
        getIssueUrl: r.issues_url.replace(/{\/number}/g, '')
      }
  }
  )
  return {userInfo, repoInfo}
}


export const metadata: Metadata = {
  title: "Dcard Intern",
  description: "Generated by create next app",
};


export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) 
{
  const data = await getUserData()
  
  return (
  <StoreProvider>
    <html lang="en">
        <body className='bg-bodycolor'>
          <Header profileData={data}/>
          <Nav />
          {children}
        </body>
    </html>
  </StoreProvider>
  );
}



